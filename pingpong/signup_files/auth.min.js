var Auth={validator:null,initialize:function(){var a=$("email"),c=$("password"),b=$("facebook_form");Auth.form=$("login_form")||$("join_form")||$("forgot_form")||$("reset_form");null!==Auth.form&&(Auth.is_lightbox=null!==Auth.form.getParent(".auth_lightbox"),Auth.form.getElement("input[name=email]").addEvent("blur",Auth.onEmailBlur.bind(this)),Auth.form.getElement("input[name=email]").addEvent("focus",Auth.onEmailFocus.bind(this)),Global.setupFormPlaceholders(),setTimeout(function(){a.focus();a.blur();
c.focus();c.blur();Auth.form.getElement('input:first-child:not([type="hidden"])').focus()},100),this.validator=new Form.Validator.Inline(Auth.form,{errorPrefix:"",useTitles:!0,scrollToErrorsOnSubmit:!1,onFormValidate:Auth.onFormValidate}),Auth.is_lightbox&&(void 0!==typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest?new Form.Request(Auth.form,null,{resetForm:!1,progress:!1,onSuccess:Auth.onAuthSuccess,onFailure:Auth.onAuthFailure,requestOptions:{withCredentials:!0}}):Cookie.write("last_page",
window.location.pathname,{duration:5/60/24,domain:vimeo.domain,path:"/"})));b&&b.getElement("a").addEvent("click",function(){b.fireEvent("submit");b.submit()})},onFormValidate:function(a){a?Auth.form.getElement("input[type=submit]").set("disabled",!0):Auth.form.getElement("input").focus()},onAuthSuccess:function(){var a=null;switch(Auth.form.get("id")){case "login_form":a=Cookie.read("last_page");null!==a?(Cookie.dispose("last_page"),(new URI(a)).go()):window.location.reload();break;case "forgot_form":Auth.form.destroy(),
$("email_sent").show()}},onAuthFailure:function(a){a=JSON.decode(a.responseText);var c=Auth.form.getElement("input"),b=Auth.form.getElements("input[type!=submit]"),d;if(!a||0===a.length)b.addClass("validation-failed");else for(d in a)Auth.form.getElement(":input[name="+d+"]").addClass("validation-failed");c.focus()},onEmailBlur:function(){var a;if((!document.all||window.opera||!window.XMLHttpRequest)&&this.validator.isFieldValid("email")&&"undefined"!==typeof EmailSuggestion)a=EmailSuggestion.check($("email").get("value")),
null===$("advice-required-email")&&a&&($("advice-suggest-email")&&$("advice-suggest-email").dispose(),(new Element("div",{id:"advice-suggest-email","class":"validation-advice suggest_email",html:"Did you mean <em>"+a+"</em>?",events:{click:function(){$("email").set("value",a);this.dispose()}}})).inject($("email").getParent(),"bottom")),this.cache&&(this.cache=null),this.cache=new Request.JSON({data:{email:$("email").get("value"),token:vimeo.xsrft},token:vimeo.xsrf,url:"/log_in?action=warm",method:"post"}),
this.cache.send()},onEmailFocus:function(){$("advice-suggest-email")&&$("advice-suggest-email").dispose()}};window.addEvent("domready",function(){Auth.initialize()});
